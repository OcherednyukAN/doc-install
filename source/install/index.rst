Установка GLPI
============

Установка происходит следующим образом:

#. Выбираем версию,
#. Скачиваем архив,
#. Устанавливаем :)

Выбор версии
----------------

.. note::

   Настоятельно рекомендуется выбрать последнюю стабильную версию для использования.

GLPI следует семантической схеме управления версиями, состоящей из 3 цифр. Первая - основной выпуск, вторая - второстепенный, а третья - выпуск исправлений.

Основные выпуски могут идти с важными несовместимостями, а также с новыми функциями; второстепенные версии могут также содержать новые функции, но оставаться полностью совместимыми внутри основной версии.

Исправления релизов будут исправлять только сообщённые проблемы, не добавляя ничего нового.

Загрузка
--------

.. warning::

   На GitHub всегда есть два архива с именем *Исходный код*, которые не должны использоваться.

Перейдите в раздел *Загрузка* на веб-сайте GLPI `<http://glpi-project.org>`_ (или получите архив непосредственно из `релиза Github <https://github.com/glpi-project/glpi/releases).>`_) и выберите архив ``glpi-{version}.tgz``.

Установка
------------

.. note::

   Пакеты могут быть доступны из вашего дистрибутива Linux (Red Hat, CentOS, Fedora, Ubuntu, ...), которые вы должны использовать со своим стандартным менеджером пакетов, как обычно.

Сама установка GLPI состоит из трех этапов:

#. Распакуйте архив на вашем сайте;
#. Дайте вашему веб-серверу доступ на запись в каталогах ``files`` и ``config``;
#. :doc:`Запустите мастер установвки <wizard>` (или используйте :ref:`Скрипт установки из командной строки <cdline_install>`).

После того, как эти три шага были выполнены, приложение готово к использованию.

Расположение файлов и каталогов
-------------------------------

Как и многие другие веб-приложения, GLPI можно установить, просто скопировав весь каталог на любой веб-сервер. Однако, это менее безопасно.

.. warning::

   Каждый файл, доступный напрямую с веб-сервера, должен считаться небезопасным!

GLPI хранит некоторые данные в каталоге ``files``, конфигурация доступа к базе данных хранится в каталоге ``config`` и т.д. Даже если GLPI предоставляет некоторые способы предотвращения доступа к файлам веб-сервера напрямую, рекомендуется хранить данные вне веб-корня. Таким образом, конфиденциальные файлы не могут быть доступны непосредственно с веб-сервера.

Существует несколько директив конфигурации, которые вы можете использовать для достижения этой цели (директивы, которые используются в предоставленных последующих пакетах):

* ``GLPI_CONFIG_DIR``: задаёт путь к каталогу конфигурации;
* ``GLPI_VAR_DIR`` : устанавливает путь к каталогу ``files``;
* ``GLPI_LOG_DIR`` : задаёт путь к файлам журналов.

.. note::

   Существует много других директив конфигурации, указанные выше следует учитывать для более безопасной установки.

Выбор каталогов полностью зависит от вас; следующий пример будет следовать рекоиендациям `FHS <http://www.pathname.com/fhs/>`_.

Наш экземпляр GLPI будет установлен в ``/var/www/glpi``, конкретный виртуальный хост в конфигурации веб-сервера будет отражать этот путь.

Конфигурация GLPI будет храниться в ``/etc/glpi``, просто скопируйте каталог ``config`` в это место. GLPI требует права на чтение в этом каталоге для работы; и права на запись в процессе установки.

Данные GLPI будут храниться в ``/var/lib/glpi``, просто скопируйте каталог ``files`` в это место. GLPI требует права на чтение и запись в этом каталоге.

Файлы журналов GLPI будут храниться в ``/var/log/glpi``, сюда ничего копировать не надо, просто создайте каталог. GLPI требует доступа для чтения и записи в этом каталоге.

Далее по инструкции, мы создадим файл ``inc/downstream.php`` в каталог GLPI со следующим содержимым:

.. code-block:: php

   <?php
   define('GLPI_CONFIG_DIR', '/etc/glpi/');

   if (file_exists(GLPI_CONFIG_DIR . '/local_define.php')) {
      require_once GLPI_CONFIG_DIR . '/local_define.php';
   }


.. warning::

   В пакете GLPI обязательно предоставяется файл ``inc/downstream.php``. Его нельзя редактировать!

   GLPI ищет `local_define.php` файл в собственном каталоге `config`. Если вы хотите использовать другой каталог конфигурации, вы должны загрузить его.

Затем создайте файл в ``/etc/glpi/local_define.php`` со следующим содержимым:

.. code-block:: php

   <?php
   define('GLPI_VAR_DIR', '/var/lib/glpi/files');
   define('GLPI_LOG_DIR', '/var/log/glpi');

.. note::

   .. versionadded:: 9.2.2

   Для GLPI до 9.2.2 константа ``GLPI_VAR_DIR`` не существовала, и требовалось указывать все пути отдельно:

   .. code-block:: php

      <?php
      define('GLPI_VAR_DIR', '/var/lib/glpi');
      define('GLPI_DOC_DIR',        GLPI_VAR_DIR);
      define('GLPI_CRON_DIR',       GLPI_VAR_DIR . '/_cron');
      define('GLPI_DUMP_DIR',       GLPI_VAR_DIR . '/_dumps');
      define('GLPI_GRAPH_DIR',      GLPI_VAR_DIR . '/_graphs');
      define('GLPI_LOCK_DIR',       GLPI_VAR_DIR . '/_lock');
      define('GLPI_PICTURE_DIR',    GLPI_VAR_DIR . '/_pictures');
      define('GLPI_PLUGIN_DOC_DIR', GLPI_VAR_DIR . '/_plugins');
      define('GLPI_RSS_DIR',        GLPI_VAR_DIR . '/_rss');
      define('GLPI_SESSION_DIR',    GLPI_VAR_DIR . '/_sessions');
      define('GLPI_TMP_DIR',        GLPI_VAR_DIR . '/_tmp');
      define('GLPI_UPLOAD_DIR',     GLPI_VAR_DIR . '/_uploads');
      define('GLPI_CACHE_DIR',      GLPI_VAR_DIR . '/_cache');

      define('GLPI_LOG_DIR', '/var/log/glpi');

      Конечно, всегда можно переопределить любой из этих путей, если это необходимо.

После установки
-----------------

После того, как GLPI был установлен, вы почти закончили.

Дополнительным шагом будет защита (или удаление) каталога установки. Например, вы можете добавить следующее в конфигурацию виртуального хоста Apache (или в файл ``glpi/install/.htaccess``):

.. code-block:: apache

    <IfModule mod_authz_core.c>
        Require local
    </IfModule>
    <IfModule !mod_authz_core.c>
        order deny, allow
        deny from all
        allow from 127.0.0.1
        allow from ::1
    </IfModule>
    ErrorDocument 403 "<p><b>Restricted area.</b><br />Only local access allowed.<br />Check your configuration or contact your administrator.</p>"

В этом примере доступ к каталогу `install` будет ограничен только localhost и в противном случае будет отображаться сообщение об ошибке. Конечно, вам, возможно, придется адаптировать это к вашим потребностям; обратитесь к документации вашего веб-сервера.
